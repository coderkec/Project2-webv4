<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team2 통합 대시보드</title>
    <style>
        /* =========================================
           [CSS] 디자인 및 레이아웃
           ========================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            padding-bottom: 190px;
            /* 하단 위젯 바 공간 확보 */
        }

        .container {
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 40px;
            padding-top: 110px;
        }

        /* 명언 카드 */
        .quote-card {
            background: white;
            border-radius: 16px;
            padding: 30px 40px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .quote-card:hover {
            transform: translateY(-2px);
        }

        .quote-text {
            font-size: 20px;
            color: #2c3e50;
            line-height: 1.6;
            margin-bottom: 12px;
            font-style: italic;
        }

        .quote-text::before {
            content: '"';
            font-size: 28px;
            color: #7c3aed;
            margin-right: 4px;
        }

        .quote-text::after {
            content: '"';
            font-size: 28px;
            color: #7c3aed;
            margin-left: 4px;
        }

        .quote-author {
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }

        /* 메인 섹션 & 질문 입력 */
        .main-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-wrapper {
            position: relative;
            width: 100%;
        }

        .question-input {
            width: 100%;
            padding: 20px 60px 20px 24px;
            font-size: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 24px;
            background: white;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .question-input:focus {
            border-color: #7c3aed;
            box-shadow: 0 6px 12px rgba(124, 58, 237, 0.15);
        }

        .send-button {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #7c3aed 0%, #6366f1 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
            transition: all 0.2s;
        }

        .send-button:hover {
            transform: translateY(-50%) scale(1.05);
        }

        /* [요청 반영] 질문 예시 버튼 (둥근 알약 스타일) */
        .example-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .example-btn {
            padding: 12px 24px;
            /* 넉넉한 여백 */
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 999px;
            /* 완전 둥근 알약 모양 */
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
        }

        .example-btn:hover {
            border-color: #7c3aed;
            color: #7c3aed;
            background: #f5f3ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(124, 58, 237, 0.15);
        }

        /* 답변 영역 */
        .response-area {
            background: white;
            border-radius: 16px;
            padding: 40px;
            min-height: 200px;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .response-area.active {
            display: flex;
        }

        .response-content {
            width: 100%;
        }

        .chat-history {
            width: 100%;
            max-height: 360px;
            overflow: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-msg {
            display: flex;
        }

        .chat-msg.user {
            justify-content: flex-end;
        }

        .chat-bubble {
            max-width: 80%;
            border-radius: 14px;
            padding: 10px 12px;
            border: 1px solid #e5e7eb;
            background: #ffffff;
            line-height: 1.4;
            font-size: 14px;
        }

        .chat-msg.user .chat-bubble {
            background: #f5f3ff;
            border-color: #ddd6fe;
        }

        .chat-meta {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 4px;
        }

        /* 하단 위젯 바 */
        .info-grid {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            bottom: 12px;
            width: calc(100% - 40px);
            max-width: 900px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            z-index: 50;
        }

        .info-card {
            background: white;
            border-radius: 14px;
            padding: 12px 14px;
            border: 1px solid #eef2f7;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .info-title {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            font-weight: 700;
            color: #334155;
            margin-bottom: 8px;
        }

        .badge {
            font-size: 11px;
            font-weight: 600;
            color: #7c3aed;
            background: #f5f3ff;
            padding: 4px 8px;
            border-radius: 999px;
        }

        .info-value {
            font-size: 18px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
        }

        .info-sub {
            font-size: 12px;
            color: #64748b;
        }

        .mini-muted {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 6px;
        }

        @media (max-width: 900px) {
            .info-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 500px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        /* =========================================
           [로그인 화면 & 툴바 스타일]
           ========================================= */
        .hidden {
            display: none !important;
        }

        #loginView {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-shell {
            width: 100%;
            max-width: 1000px;
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 20px;
        }

        .login-hero {
            border-radius: 22px;
            padding: 40px;
            color: #0f172a;
            background: radial-gradient(at 20% 20%, rgba(124, 58, 237, 0.15), transparent 50%),
                linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
            border: 1px solid #e5e7eb;
            position: relative;
            overflow: hidden;
        }

        .login-hero h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .login-hero p {
            font-size: 15px;
            color: #334155;
            line-height: 1.6;
        }

        .hero-pill {
            display: inline-block;
            margin-top: 15px;
            font-size: 12px;
            font-weight: 700;
            color: #4f46e5;
            background: rgba(79, 70, 229, 0.1);
            padding: 6px 12px;
            border-radius: 999px;
        }

        .login-panel {
            background: white;
            border-radius: 22px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid #eef2f7;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .login-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .login-desc {
            font-size: 13px;
            color: #64748b;
            margin-bottom: 20px;
        }

        .login-field {
            margin-bottom: 15px;
        }

        .login-field label {
            display: block;
            font-size: 12px;
            font-weight: 700;
            color: #334155;
            margin-bottom: 5px;
        }

        .login-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            outline: none;
            transition: 0.2s;
        }

        .login-input:focus {
            border-color: #7c3aed;
        }

        .btn-primary {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 12px;
            background: #7c3aed;
            color: white;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .btn-primary:hover {
            background: #6d28d9;
        }

        .btn-ghost {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            color: #334155;
            font-weight: 700;
            cursor: pointer;
        }

        .login-links {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 13px;
        }

        .link-btn {
            background: none;
            border: none;
            color: #7c3aed;
            font-weight: 600;
            cursor: pointer;
        }

        .link-btn:hover {
            text-decoration: underline;
        }

        /* [요청 반영] 회원가입/비번찾기 추가 패널 */
        #authExtra {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .extra-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #334155;
        }

        /* 상단 툴바 */
        #toolbar {
            position: fixed;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            max-width: 900px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .tb-left {
            font-weight: 900;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tb-chip {
            font-size: 11px;
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 6px;
            color: #64748b;
        }

        .tb-center {
            display: flex;
            gap: 10px;
        }

        .tb-ind {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 700;
            color: #334155;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ccc;
        }

        .ok .dot {
            background: #22c55e;
        }

        .bad .dot {
            background: #ef4444;
        }

        .tb-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
        }

        .guestbar {
            position: fixed;
            top: 12px;
            right: 20px;
            z-index: 100;
        }

        .gbtn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        @media (max-width: 900px) {
            .login-shell {
                grid-template-columns: 1fr;
            }

            .login-hero {
                padding: 30px;
            }
        }
    </style>
</head>

<body>

    <div id="loginView">
        <div class="login-shell">
            <div class="login-hero">
                <h1>Team2 통합 대시보드</h1>
                <p>날씨 · 전력 · 환율 · 시간 정보를 한눈에 확인하세요.</p>
                <span class="hero-pill">K8s 기반 통합 관제</span>
            </div>
            <div class="login-panel">
                <div class="login-title">로그인</div>
                <div class="login-desc">관리자(admin)는 상단 툴바가 활성화됩니다.</div>

                <div class="login-field">
                    <label>아이디</label>
                    <input class="login-input" id="loginUser" placeholder="admin 또는 계정">
                </div>
                <div class="login-field">
                    <label>비밀번호</label>
                    <input class="login-input" id="loginPass" type="password" placeholder="admin123">
                </div>

                <button class="btn-primary" id="btnLogin">로그인</button>
                <button class="btn-ghost" id="btnGuest">비회원 입장</button>

                <div class="login-links">
                    <button class="link-btn" id="btnShowSignup">회원가입</button>
                    <button class="link-btn" id="btnShowReset">비밀번호 찾기</button>
                </div>
                <div id="loginHint" style="font-size:12px; color:#ef4444; margin-top:10px;"></div>

                <div id="authExtra" class="hidden">
                    <div id="signupPane" class="hidden">
                        <div class="extra-title">새 계정 만들기</div>
                        <input class="login-input" id="suUser" placeholder="사용할 아이디" style="margin-bottom:8px;">
                        <input class="login-input" id="suPass" type="password" placeholder="사용할 비밀번호"
                            style="margin-bottom:8px;">
                        <button class="btn-primary" id="btnDoSignup">가입하기</button>
                        <button class="link-btn" onclick="closeExtra()" style="width:100%">취소</button>
                    </div>
                    <div id="resetPane" class="hidden">
                        <div class="extra-title">비밀번호 재설정</div>
                        <input class="login-input" id="rpUser" placeholder="가입된 아이디" style="margin-bottom:8px;">
                        <input class="login-input" id="rpNewPass" type="password" placeholder="새 비밀번호"
                            style="margin-bottom:8px;">
                        <button class="btn-primary" id="btnDoReset">변경하기</button>
                        <button class="link-btn" onclick="closeExtra()" style="width:100%">취소</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboardView" class="hidden">
        <div id="toolbar" class="hidden">
            <div class="tb-left">ADMIN <span class="tb-chip" id="tbUserChip"></span></div>
            <div class="tb-center">
                <span class="tb-ind" id="indWeather"><span class="dot"></span>Weather</span>
                <span class="tb-ind" id="indEnergy"><span class="dot"></span>Energy</span>
                <span class="tb-ind" id="indFx"><span class="dot"></span>FX</span>
                <span class="tb-ind" id="indTime"><span class="dot"></span>Time</span>
            </div>
            <div class="tb-right">
                <button class="tb-btn" id="tbRefresh">위젯 갱신</button>
                <button class="tb-btn" id="tbLogout">로그아웃</button>
            </div>
        </div>
        <div id="guestBar" class="guestbar hidden">
            <button class="gbtn" id="guestLogout">로그아웃</button>
        </div>

        <div class="container">
            <div class="quote-card">
                <div class="quote-text" id="quoteText">Loading...</div>
                <div class="quote-author" id="quoteAuthor"></div>
            </div>

            <div class="main-section">
                <div class="input-wrapper">
                    <input type="text" class="question-input" id="questionInput" placeholder="질문을 입력하세요...">
                    <button class="send-button" id="sendButton">▲</button>
                </div>
                <div class="example-questions">
                    <button class="example-btn" data-question="오늘 날씨 알려줘">현재 날씨</button>
                    <button class="example-btn" data-question="전력 사용량">전력 정보</button>
                    <button class="example-btn" data-question="환율 정보">환율 확인</button>
                    <button class="example-btn" data-question="현재 시간">현재 시간</button>
                </div>
            </div>

            <div class="response-area" id="responseArea">
                <div class="chat-history" id="chatHistory"></div>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <div class="info-title">날씨 <span class="badge">Open-Meteo</span></div>
                <div class="info-value" id="weatherValue">—</div>
                <div class="info-sub" id="weatherSub">로딩 중...</div>
            </div>
            <div class="info-card">
                <div class="info-title">전력(KPX) <span class="badge">지역별</span></div>
                <div class="info-value" id="energyValue">—</div>
                <div class="info-sub" id="energySub">로딩 중...</div>
                <div class="mini-muted" id="energyMeta"></div>
            </div>
            <div class="info-card">
                <div class="info-title">환율 <span class="badge">USD→KRW</span></div>
                <div class="info-value" id="fxValue">—</div>
                <div class="info-sub" id="fxSub">로딩 중...</div>
            </div>
            <div class="info-card">
                <div class="info-title">시간 <span class="badge">KST</span></div>
                <div class="info-value" id="timeValue">—</div>
                <div class="info-sub" id="timeSub">로딩 중...</div>
            </div>
        </div>
    </div>

    <script>
        // =========================================
        // [Logic] 전체 기능 구현
        // =========================================
        const AUTH_KEY = "team2_auth_v1";
        const USERS_KEY = "team2_users_v1"; // 회원가입 정보 저장용

        // API 설정 (에너지는 내부망, 나머지는 외부망)
        const API_BASE = "";
        const WIDGETS = {
            energyUrl: "/api/energy/kpx/now?page=1&perPage=2",
            fxUrl: "https://open.er-api.com/v6/latest/USD",
            weatherUrl: "https://api.open-meteo.com/v1/forecast?latitude=37.5665&longitude=126.978&current_weather=true"
        };
        const HEALTH = { weather: null, energy: null, fx: null, time: null };

        // --- 1. 인증 및 UI 핸들링 ---
        function loadUsers() { return JSON.parse(localStorage.getItem(USERS_KEY) || "{}"); }
        function saveUsers(u) { localStorage.setItem(USERS_KEY, JSON.stringify(u)); }

        // 패널 열기/닫기
        document.getElementById("btnShowSignup").onclick = () => {
            document.getElementById("authExtra").classList.remove("hidden");
            document.getElementById("signupPane").classList.remove("hidden");
            document.getElementById("resetPane").classList.add("hidden");
        };
        document.getElementById("btnShowReset").onclick = () => {
            document.getElementById("authExtra").classList.remove("hidden");
            document.getElementById("signupPane").classList.add("hidden");
            document.getElementById("resetPane").classList.remove("hidden");
        };
        window.closeExtra = () => document.getElementById("authExtra").classList.add("hidden");

        // 회원가입 실행
        document.getElementById("btnDoSignup").onclick = () => {
            const u = document.getElementById("suUser").value.trim();
            const p = document.getElementById("suPass").value.trim();
            if (!u || !p) return alert("아이디와 비밀번호를 입력하세요.");
            if (u === "admin") return alert("admin 아이디는 사용할 수 없습니다.");

            const users = loadUsers();
            if (users[u]) return alert("이미 존재하는 아이디입니다.");

            users[u] = { pass: p, joined: Date.now() };
            saveUsers(users);
            alert("가입 완료! 로그인 해주세요.");
            closeExtra();
        };

        // 비번 변경 실행
        document.getElementById("btnDoReset").onclick = () => {
            const u = document.getElementById("rpUser").value.trim();
            const p = document.getElementById("rpNewPass").value.trim();
            if (!u || !p) return alert("정보를 입력하세요.");

            const users = loadUsers();
            if (!users[u]) return alert("존재하지 않는 아이디입니다.");

            users[u].pass = p;
            saveUsers(users);
            alert("비밀번호가 변경되었습니다.");
            closeExtra();
        };

        // 로그인 실행
        document.getElementById("btnLogin").onclick = () => {
            const u = document.getElementById("loginUser").value.trim();
            const p = document.getElementById("loginPass").value.trim();

            // 관리자 확인
            if (u === "admin" && p === "admin123") {
                localStorage.setItem(AUTH_KEY, JSON.stringify({ user: u, role: "admin" }));
                location.reload();
                return;
            }
            // 일반 회원 확인
            const users = loadUsers();
            if (users[u] && users[u].pass === p) {
                localStorage.setItem(AUTH_KEY, JSON.stringify({ user: u, role: "user" }));
                location.reload();
            } else {
                document.getElementById("loginHint").textContent = "아이디 또는 비밀번호가 일치하지 않습니다.";
            }
        };

        document.getElementById("btnGuest").onclick = () => {
            localStorage.setItem(AUTH_KEY, JSON.stringify({ user: "Guest", role: "guest" }));
            location.reload();
        };

        const logout = () => { localStorage.removeItem(AUTH_KEY); location.reload(); };
        document.getElementById("tbLogout").onclick = logout;
        document.getElementById("guestLogout").onclick = logout;

        // --- 2. 데이터 위젯 (API 로직 유지) ---
        async function loadEnergy() {
            try {
                const res = await fetch(API_BASE + WIDGETS.energyUrl);
                const json = await res.json();
                const row = json.data[0];
                const year = new Date().getFullYear();

                document.getElementById("energyValue").textContent = `연도 ${year}`;
                // 서울, 부산, 인천 데이터만 추출
                document.getElementById("energySub").textContent =
                    `서울 ${row["서울"] || '-'} · 부산 ${row["부산"] || '-'} · 인천 ${row["인천"] || '-'}`;

                HEALTH.energy = true;
            } catch (e) {
                document.getElementById("energyValue").textContent = "데이터 없음";
                HEALTH.energy = false;
            }
            updateHealth();
        }

        async function loadFx() {
            try {
                const res = await fetch(WIDGETS.fxUrl);
                const data = await res.json();
                const rate = data.rates["KRW"];

                document.getElementById("fxValue").textContent = rate.toFixed(2);
                document.getElementById("fxSub").textContent = `1 USD = ${rate.toFixed(2)} KRW`;
                HEALTH.fx = true;
            } catch {
                document.getElementById("fxValue").textContent = "연결 실패";
                HEALTH.fx = false;
            }
            updateHealth();
        }

        async function loadWeather() {
            try {
                const res = await fetch(WIDGETS.weatherUrl);
                const data = await res.json();
                const temp = data.current_weather.temperature;

                document.getElementById("weatherValue").textContent = `${temp}°C`;
                document.getElementById("weatherSub").textContent = "서울 현재 기온";
                HEALTH.weather = true;
            } catch { HEALTH.weather = false; }
            updateHealth();
        }

        function loadTime() {
            const now = new Date();
            document.getElementById("timeValue").textContent = now.toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit' });
            document.getElementById("timeSub").textContent = now.toLocaleDateString('ko-KR');
            HEALTH.time = true;
            updateHealth();
        }

        function updateHealth() {
            Object.keys(HEALTH).forEach(k => {
                const el = document.getElementById(`ind${k.charAt(0).toUpperCase() + k.slice(1)}`);
                if (el) {
                    el.classList.remove("ok", "bad");
                    el.classList.add(HEALTH[k] ? "ok" : "bad");
                }
            });
        }

        async function refreshWidgets() {
            await Promise.allSettled([loadWeather(), loadEnergy(), loadFx(), loadTime()]);
            alert("위젯 정보가 갱신되었습니다.");
        }
        document.getElementById("tbRefresh").onclick = refreshWidgets;

        // --- 3. 채팅 & 기타 ---
        function loadQuote() {
            const list = [
                { t: "Simplicity is the soul of efficiency.", a: "Austin Freeman" },
                { t: "Data is the new oil.", a: "Clive Humby" },
                { t: "Code never lies, comments sometimes do.", a: "Ron Jeffries" }
            ];
            const r = list[Math.floor(Math.random() * list.length)];
            document.getElementById("quoteText").textContent = r.t;
            document.getElementById("quoteAuthor").textContent = "- " + r.a;
        }

        function sendQuestion() {
            const inp = document.getElementById("questionInput");
            const q = inp.value.trim();
            if (!q) return;

            const area = document.getElementById("responseArea");
            const hist = document.getElementById("chatHistory");
            area.classList.add("active");

            hist.innerHTML += `<div class="chat-msg user"><div class="chat-bubble">${q}</div></div>`;
            inp.value = "";

            // 봇 응답 (키워드 매칭)
            let ans = "질문을 이해하지 못했습니다. (날씨, 전력, 환율)";
            if (q.includes("날씨")) ans = `현재 기온은 ${document.getElementById("weatherValue").textContent} 입니다.`;
            else if (q.includes("환율")) ans = `현재 환율은 ${document.getElementById("fxValue").textContent}원 입니다.`;
            else if (q.includes("전력")) ans = `전력 정보: ${document.getElementById("energySub").textContent}`;

            setTimeout(() => {
                hist.innerHTML += `<div class="chat-msg"><div class="chat-bubble">${ans}</div></div>`;
                hist.scrollTop = hist.scrollHeight;
            }, 400);
        }

        document.getElementById("sendButton").onclick = sendQuestion;
        document.getElementById("questionInput").addEventListener("keypress", (e) => {
            if (e.key === "Enter") sendQuestion();
        });

        // 질문 예시 버튼 클릭 연결
        document.querySelectorAll(".example-btn").forEach(btn => {
            btn.onclick = () => {
                document.getElementById("questionInput").value = btn.getAttribute("data-question");
                sendQuestion();
            };
        });

        // --- 초기화 ---
        window.onload = () => {
            const auth = JSON.parse(localStorage.getItem(AUTH_KEY));
            if (auth) {
                document.getElementById("loginView").classList.add("hidden");
                document.getElementById("dashboardView").classList.remove("hidden");

                if (auth.role === "admin") {
                    document.getElementById("toolbar").classList.remove("hidden");
                    document.getElementById("tbUserChip").textContent = auth.user;
                } else {
                    document.getElementById("guestBar").classList.remove("hidden");
                }

                loadQuote();
                refreshWidgets(); // 최초 로드
                setInterval(loadTime, 30000);
            }
        };
    </script>
</body>

</html>